<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autenticando...</title>
</head>
<body>
    <h2 id="status">Procesando autenticaci√≥n...</h2>

    <script>
        window.onload = function() {
            console.log("üîπ DOM completamente cargado.");

            const statusElement = document.getElementById("status");
            if (!statusElement) {
                console.error("‚ö†Ô∏è Error: No se encontr√≥ el elemento #status");
                return;
            }

            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get("code");

            if (code) {
                statusElement.innerText = "Autenticaci√≥n exitosa. Procesando...";

                fetch("https://pruebainventario.onrender.com/callback", {
                    method: "POST",
                    credentials: "include",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ code }) 
                })
                .then(response => response.json())
                .then(data => {
                    console.log("‚úÖ C√≥digo enviado al servidor:", data);
                    statusElement.innerText = "¬°Listo! Puedes cerrar esta p√°gina.";
                })
                .catch(error => {
                    console.error("‚ö†Ô∏è Error al enviar c√≥digo:", error);
                    statusElement.innerText = "Hubo un error. Intenta nuevamente.";
                });
            } else {
                statusElement.innerText = "‚ö†Ô∏è Error: No se recibi√≥ c√≥digo de autenticaci√≥n.";
            }
        };
    </script>
</body>
</html>
